# PRINT_CANCEL
A print generally ends in one of two ways - either it is successful and completes normally, or something goes awry and you cancel it. Klipper can be configured to do different things in each case.
Here, we're addressing what to do when a print is prematurely cancelled. Note that if an "emergency stop" mechanism is used, this macro will not be executed.

The main things we're doing here are calling the timer to log the elapsed time, if the TIMER macros are being used, and then positioning the toolhead out of the way. In this example, it is moved
to the front of the printer, center-top, so it is easy to have a look at the nozzle and see if anything is amiss. This can also as a visual cue that the print was cancelled. 
Note that a print could be cancelled automatically due to missed temperature targets and that kind of thing.

NOTE: In order for this to be called, Klipper must be told about it. This is handled using the "on_error_gcode" directive which typically appears near the top of the printer.cfg file. 
It, and the PRINT_CANCEL macro, may already exist or might not be present. Be sure to also check for CANCEL_PRINT macro and consider combining the two into one macro. 
Alternatively, this directive could be added to the g-code generated by the slicer.
``` 
on_error_gcode: PRINT_CANCEL
```
NOTE: Due to the single-threaded nature of Klipper and other aspects of its core architecture, running the PRINT_CANCEL macro doesn't usually immediately stop the print. It will complete the gcode 
command it is currently working on. If that's printing a line of filament, as in a NOZZLE_PRIME, then the entire line will print before it recognizes the cancel request. 

In the case of macros, and in particular the PRINT_START macro, Klipper will wait until the *entire* macro completes before acknowledging the cancel request. 
It may often be quicker to use the emergency stop function and restart Klipper rather than wait for it to finish, particularly if you want to cancel a print job before it has laid down any filament. 
```

#######################################
# PRINT_CANCEL macro
#######################################
[gcode_macro PRINT_CANCEL]
description: Cancel print abruptly
gcode:

    # Show elapsed time (Note: Requires TIMER macros)
    # RUN_SHELL_COMMAND CMD=shell_get_elapsed_time PARAMS='__CANCELLED'
    
    # Retract filament if possible
    {% if printer.extruder.can_extrude %}
        G91               # Relative positioning
        G1 E-5.00 F1000   # Retract 5mm of filament
    {% else %}
        M118 PRINT_CANCEL: Extruder Temp: {printer.extruder.temperature}
        M118 PRINT_CANCEL: Extruder too cool to retract
    {% endif %}

    # Pick a final position - Assuming a 350mm x 350mm x 310mm print volume
    # Here, the toolhead is presented for inspection following a failure
    G90                   # Absolute positioning
    G1 Z310               # Max Z first
    G1 X175               # Center X
    G1 Y10                # Front Y
    
    CLEAR_PAUSE



#######################################
# CANCEL_PRINT macro
#######################################
[gcode_macro CANCEL_PRINT]
rename_existing: BASE_CANCEL_PRINT
gcode:
    PRINT_CANCEL
    BASE_CANCEL_PRINT

```
